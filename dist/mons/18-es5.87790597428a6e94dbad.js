!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"/yFf":function(e,t,r){"use strict";var n=r("oHnp");function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.get=function(e){return this.header[e.toLowerCase()]},i.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=n.type(t);var r=n.params(t);for(var i in r)this[i]=r[i];this.links={};try{e.link&&(this.links=n.parseLinks(e.link))}catch(s){}},i.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e}},"24Ii":function(e,t,r){var n;"undefined"!=typeof window?n=window:"undefined"!=typeof self?n=self:(console.warn("Using browser-only version of superagent in non-browser environment"),n=this);var i=r("cpc2"),s=r("kMlx"),o=r("8zgK"),a=r("/yFf"),u=r("nZbv");function c(){}var l=t=e.exports=function(e,r){return"function"==typeof r?new t.Request("GET",e).end(r):1==arguments.length?new t.Request("GET",e):new t.Request(e,r)};t.Request=y,l.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&"file:"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var h="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function f(e){if(!o(e))return e;var t=[];for(var r in e)d(t,r,e[r]);return t.join("&")}function d(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach((function(r){d(e,t,r)}));else if(o(r))for(var n in r)d(e,t+"["+n+"]",r[n]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function p(e){for(var t,r,n={},i=e.split("&"),s=0,o=i.length;s<o;++s)-1==(r=(t=i[s]).indexOf("="))?n[decodeURIComponent(t)]="":n[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return n}function v(e){return/[\/+]json($|[^-\w])/.test(e)}function g(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=function(e){for(var t,r,n,i,s=e.split(/\r?\n/),o={},a=0,u=s.length;a<u;++a)-1!==(t=(r=s[a]).indexOf(":"))&&(n=r.slice(0,t).toLowerCase(),i=h(r.slice(t+1)),o[n]=i);return o}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.body=null===this.text&&e._responseType?this.xhr.response:"HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function y(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",(function(){var e,t=null,n=null;try{n=new g(r)}catch(i){return(t=new Error("Parser is unable to parse the response")).parse=!0,t.original=i,r.xhr?(t.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,t.status=r.xhr.status?r.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),r.callback(t)}r.emit("response",n);try{r._isResponseOK(n)||(e=new Error(n.statusText||"Unsuccessful HTTP response"))}catch(s){e=s}e?(e.original=t,e.response=n,e.status=n.status,r.callback(e,n)):r.callback(null,n)}))}function _(e,t,r){var n=l("DELETE",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}l.serializeObject=f,l.parseString=p,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":f,"application/json":JSON.stringify},l.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse},a(g.prototype),g.prototype._parseBody=function(e){var t=l.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&v(this.type)&&(t=l.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},g.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n=new Error("cannot "+t+" "+r+" ("+this.status+")");return n.status=this.status,n.method=t,n.url=r,n},l.Response=g,i(y.prototype),s(y.prototype),y.prototype.type=function(e){return this.set("Content-Type",l.types[e]||e),this},y.prototype.accept=function(e){return this.set("Accept",l.types[e]||e),this},y.prototype.auth=function(e,t,r){1===arguments.length&&(t=""),"object"==typeof t&&null!==t&&(r=t,t=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});var n=function(e){if("function"==typeof btoa)return btoa(e);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(e,t,r,n)},y.prototype.query=function(e){return"string"!=typeof e&&(e=f(e)),e&&this._query.push(e),this},y.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this},y.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},y.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),r(e,t)},y.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},y.prototype.buffer=y.prototype.ca=y.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},y.prototype.pipe=y.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},y.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},y.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||c,this._finalizeQueryString(),this._end()},y.prototype._end=function(){var e=this,t=this.xhr=l.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var n;try{n=t.status}catch(i){n=0}if(!n){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var n=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=n.bind(null,"download"),t.upload&&(t.upload.onprogress=n.bind(null,"upload"))}catch(a){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(u){return this.callback(u)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var i=this._header["content-type"],s=this._serializer||l.serialize[i?i.split(";")[0]:""];!s&&v(i)&&(s=l.serialize["application/json"]),s&&(r=s(r))}for(var o in this.header)null!=this.header[o]&&this.header.hasOwnProperty(o)&&t.setRequestHeader(o,this.header[o]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send(void 0!==r?r:null),this},l.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(e){u.prototype[e.toLowerCase()]=function(t,r){var n=new l.Request(e,t);return this._setDefaults(n),r&&n.end(r),n}})),u.prototype.del=u.prototype.delete,l.get=function(e,t,r){var n=l("GET",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.head=function(e,t,r){var n=l("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.options=function(e,t,r){var n=l("OPTIONS",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.del=_,l.delete=_,l.patch=function(e,t,r){var n=l("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.post=function(e,t,r){var n=l("POST",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.put=function(e,t,r){var n=l("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}},"4Mn8":function(e,t,r){var n=r("pzNo");e.exports={Client:n}},"6WMX":function(e,t,r){var n=r("B3Rj"),i=r("b3gk"),s=r("tjlA").Buffer,o=r("L21C"),a=s.from("01","hex"),u=r("L21C").HARDENED_OFFSET,c=[44+u,u,u,1,0],l={LEGACY:0,SEGWIT:5,TESTNET:111,SEGWIT_TESTNET:196};t.addressVersion=l;var h={P2PKH:1,P2SH:2,P2SH_P2WPKH:3};function f(e,t){return s.concat([e,t])}function d(e){var t=s.alloc(4);return t.writeUInt32LE(e),t}function p(e){var t;return e<253?(t=s.alloc(1)).writeUInt8(e):e<=65535?((t=s.alloc(3)).writeUInt8(253,0),t.writeUInt16LE(e,1)):e<4294967295?((t=s.alloc(5)).writeUInt8(254,0),t.writeUInt32LE(e,1)):((t=s.alloc(9)).writeUInt8(255,0),t.writeUInt32LE(e>>>0,1),t.writeUInt32LE(e/4294967296|0,5)),t}function v(e,t,r){"number"==typeof e&&(e=e.toString(16));var n=s.alloc(8),i=e.length%2==0?e.toString(16):"0"+e.toString(16);return s.from(i,"hex").reverse().copy(n,0),n.copy(t,r),n}t.scriptTypes=h,t.buildBitcoinTxRequest=function(e){try{var t=e.prevOuts,r=e.recipient,a=e.value,u=e.changePath,f=void 0===u?c:u,d=e.fee,p=e.isSegwit,g=e.changeVersion,y=void 0===g?"SEGWIT":g;if(5!==f.length)throw new Error("Please provide a full change path.");var _=s.alloc(59+69*t.length),E=0;if(void 0===l[y])throw new Error("Invalid change version specified.");_.writeUInt8(l[y]),E++,_.writeUInt32LE(f.length,E),E+=4;for(var m=0;m<f.length;m++)_.writeUInt32LE(f[m],E),E+=4;_.writeUInt32LE(d,E),E+=4;var w=n.decode(r)[0],S=i.decode(r).slice(1);_.writeUInt8(w,E),E++,S.copy(_,E),E+=S.length,v(a,_,E),E+=8,_.writeUInt8(t.length,E),E++;var R=0,b=!0===p?h.P2SH_P2WPKH:h.P2PKH;return t.forEach((function(e){if(!e.signerPath||5!==e.signerPath.length)throw new Error("Full recipient path not specified ");_.writeUInt32LE(e.signerPath.length,E),E+=4;for(var t=0;t<e.signerPath.length;t++)_.writeUInt32LE(e.signerPath[t],E),E+=4;_.writeUInt32LE(e.index,E),E+=4,v(e.value,_,E),E+=8,R+=e.value,_.writeUInt8(b,E),E++,s.isBuffer(e.txHash)||(e.txHash=s.from(e.txHash,"hex")),e.txHash.copy(_,E),E+=e.txHash.length})),{payload:_,schema:o.signingSchema.BTC_TRANSFER,origData:e,changeData:{changeVersion:y,value:R-(a+d)}}}catch(T){return{err:T}}},t.serializeTx=function(e){var t=e.inputs,r=e.outputs,o=e.isSegwitSpend,u=e.lockTime,c=void 0===u?0:u,h=e.crypto,g=s.alloc(4),y=0;g.writeUInt32LE(2,y),y+=4,!0===o&&(g=f(g,s.from("00","hex")),g=f(g,s.from("01","hex")));var _=p(t.length);g=f(g,_),y+=_.length,t.forEach((function(e){g=f(g,e.hash.reverse()),y+=e.hash.length;var t=d(e.index);if(g=f(g,t),y+=t.length,!0===o){var r=function(e,t){var r=s.alloc(22),n=t.createHash("sha256").update(e).digest(),i=t.createHash("rmd160").update(n).digest();return r.writeUInt8(0),r.writeUInt8(i.length,1),i.copy(r,2),r}(e.pubkey,h),n=p(r.length),i=s.concat([n,r]),u=p(i.length);g=f(g,u),y+=u.length,g=f(g,i),y+=i.length}else{var c=function(e,t){var r=p((e=s.concat([e,a])).length),n=p(t.length),i=s.concat([r,e,n,t]),o=p(i.length);return s.concat([o,i])}(e.sig,e.pubkey);g=f(g,c),y+=c.length}var l=d(4294967295);g=f(g,l),y+=l.length}));var E=p(r.length);if(g=f(g,E),y+=E.length,r.forEach((function(e){var t,r,o=(t=e.value,r=s.alloc(8),v(t,r,0),r);g=f(g,o),y+=o.length;var a,u,c,h=(a=e.recipient,u=n.decode(a)[0],c=i.decode(a).slice(1),u===l.SEGWIT||u===l.SEGWIT_TESTNET?function(e){var t=s.alloc(3+e.length),r=0;return t.writeUInt8(169,r),r++,t.writeUInt8(e.length,r),r++,e.copy(t,r),r+=e.length,t.writeUInt8(135,r),r++,t}(c):function(e){var t=s.alloc(5+e.length),r=0;return t.writeUInt8(118,r),r++,t.writeUInt8(169,r),r++,t.writeUInt8(e.length,r),r++,e.copy(t,r),r+=e.length,t.writeUInt8(136,r),r++,t.writeUInt8(172,r),r++,t}(c)),d=p(h.length);g=f(g,d),y+=d.length,g=f(g,h),y+=h.length})),!0===o){for(var m=[],w=[],S=0;S<t.length;S++)m.push(t[S].sig),w.push(t[S].pubkey);var R=function(e,t){var r=s.alloc(0),n=s.alloc(1);n.writeUInt8(2);for(var i=0;i<e.length;i++){var o=s.concat([e[i],a]),u=p(o.length),c=t[i],l=p(c.length);r=s.concat([r,n,u,o,l,c])}return r}(m,w);g=f(g,R),y+=R.length}return s.concat([g,d(c)]).toString("hex")},t.getBitcoinAddress=function(e,t){return i.encode(s.concat([s.from([t]),e]))}},"8zgK":function(e,t,r){"use strict";e.exports=function(e){return null!==e&&"object"==typeof e}},L21C:function(e,t){var n,i={finalizePair:0,getAddresses:1290,sign:1090,getWallets:142,test:1646},s=0;Object.keys(i).forEach((function(e){i[e]+82>s&&(s=i[e]+82)}));var o={RESP_SUCCESS:0,RESP_ERR_INVALID_MSG:128,RESP_ERR_UNSUPPORTED_VER:129,RESP_ERR_DEV_BUSY:130,RESP_ERR_USER_TIMEOUT:131,RESP_ERR_USER_DECLINED:132,RESP_ERR_PAIR_FAIL:133,RESP_ERR_PAIR_DISABLED:134,RESP_ERR_PERMISSION_DISABLED:135,RESP_ERR_INTERNAL:136,RESP_ERR_GCE_TIMEOUT:137,RESP_ERR_WALLET_NOT_PRESENT:138,RESP_ERR_DEV_LOCKED:139,RESP_ERR_DISABLED:140};e.exports={ADDR_STR_LEN:129,AES_IV:[109,121,115,101,99,114,101,116,112,97,115,115,119,111,114,100],BASE_URL:"https://signing.gridpl.us",ENC_MSG_LEN:s,addressSizes:{BTC:20,ETH:20},decResLengths:i,deviceCodes:{CONNECT:1,ENCRYPTED_REQUEST:2},encReqCodes:{FINALIZE_PAIRING:0,GET_ADDRESSES:1,ADD_PERMISSION:2,SIGN_TRANSACTION:3,GET_WALLETS:4,TEST:5},ethMsgProtocol:{SIGN_PERSONAL:0},messageConstants:{NOT_PAIRED:0,PAIRED:1},responseCodes:o,responseMsgs:(n={},r(n,o.RESP_SUCCESS,0),r(n,o.RESP_ERR_INVALID_MSG,"Invalid Request"),r(n,o.RESP_ERR_UNSUPPORTED_VER,"Unsupported Version"),r(n,o.RESP_ERR_DEV_BUSY,"Device Busy"),r(n,o.RESP_ERR_USER_TIMEOUT,"Timeout Waiting for User"),r(n,o.RESP_ERR_USER_DECLINED,"Request Declined by User"),r(n,o.RESP_ERR_PAIR_FAIL,"Pairing Failed"),r(n,o.RESP_ERR_PAIR_DISABLED,"Pairing is Currently Disabled"),r(n,o.RESP_ERR_PERMISSION_DISABLED,"Automated Signing is Currently Disabled"),r(n,o.RESP_ERR_INTERNAL,"Device Error"),r(n,o.RESP_ERR_GCE_TIMEOUT,"Timeout"),r(n,o.RESP_ERR_WALLET_NOT_PRESENT,"Incorrect Wallet UID Provided"),r(n,o.RESP_ERR_DEV_LOCKED,"Device Locked"),r(n,o.RESP_ERR_DISABLED,"Disabled"),n),signingSchema:{BTC_TRANSFER:0,ETH_TRANSFER:1,ERC20_TRANSFER:2,ETH_MSG:3},ETH_DATA_MAX_SIZE:1024,ETH_MSG_MAX_SIZE:1024,REQUEST_TYPE_BYTE:2,VERSION_BYTE:1,HARDENED_OFFSET:2147483648}},PLHu:function(e,t,r){var n=r("6WMX").buildBitcoinTxRequest,i=r("xKF7"),s=i.buildEthereumTxRequest,o=i.buildEthereumMsgRequest,a=r("tjlA").Buffer,u=r("cke4"),c=r("cC09"),l=r("MzeL"),h=r("L21C"),f=h.AES_IV,d=h.responseCodes,p=h.responseMsgs,v=h.VERSION_BYTE,g=new(0,l.ec)("p256");function y(e){return c.buf(e)>>>0}e.exports={signReqResolver:{BTC:n,ETH:s,ETH_MSG:o},aes256_decrypt:function(e,t){var r=a.from(f),n=new u.ModeOfOperation.cbc(t,r);return a.from(n.decrypt(e))},aes256_encrypt:function(e,t){var r=a.from(f),n=new u.ModeOfOperation.cbc(t,r),i=e.length%16==0?e:u.padding.pkcs7.pad(e);return a.from(n.encrypt(i))},parseDER:function(e){if(48!==e[0]||2!==e[2])return null;var t=3,r={r:null,s:null},n=e[t];if(t++,r.r=e.slice(t,t+n),2!==e[t+=n])return null;var i=e[++t];return t++,r.s=e.slice(t,t+i),r},checksum:y,parseLattice1Response:function(e){var t={err:null,data:null},r=a.from(e,"hex"),n=0,i=r.readUInt8(n);if(n++,i!==v)return t.err="Incorrect protocol version. Please update your SDK",t;var s=r.readUInt8(n);if(n++,0!==s)return t.err="Incorrect response from Lattice1",t;r.readUInt32BE(n),n+=4;var o=r.readUInt16BE(n);n+=2;var u=r.slice(n,n+o);n+=o;var c=u.readUInt8(0);return c!==d.RESP_SUCCESS?(t.err="Error from device: "+(p[c]?p[c]:"Unknown Error"),t.responseCode=c,t):(t.data=u.slice(1,u.length),r.readUInt32BE(n)!==y(r.slice(0,r.length-4))?(t.err="Invalid checksum from device response",t.data=null,t):t)},getP256KeyPair:function(e){return g.keyFromPrivate(e,"hex")},getP256KeyPairFromPub:function(e){return g.keyFromPublic(e,"hex")},toPaddedDER:function(e){var t=a.alloc(74);return a.from(e.toDER()).copy(t),t}}},RP9m:function(e,t,r){var n=r("9lTW"),i=r("tjlA").Buffer;function s(e,t){if("00"===e.slice(0,2))throw new Error("invalid RLP: extra zeros");return parseInt(e,t)}function o(e,t){if(e<56)return new i([e+t]);var r=u(e),n=u(t+55+r.length/2);return new i(n+r,"hex")}function a(e){return"0x"===e.slice(0,2)}function u(e){var t=e.toString(16);return t.length%2&&(t="0"+t),t}function c(e){if(!i.isBuffer(e))if("string"==typeof e)e=a(e)?new i(((r="string"!=typeof(n=e)?n:a(n)?n.slice(2):n).length%2&&(r="0"+r),r),"hex"):new i(e);else if("number"==typeof e)e?(t=u(e),e=new i(t,"hex")):e=new i([]);else if(null==e)e=new i([]);else{if(!e.toArray)throw new Error("invalid type");e=new i(e.toArray())}var t,r,n;return e}t.encode=function(e){if(e instanceof Array){for(var r=[],n=0;n<e.length;n++)r.push(t.encode(e[n]));var s=i.concat(r);return i.concat([o(s.length,192),s])}return 1===(e=c(e)).length&&e[0]<128?e:i.concat([o(e.length,128),e])},t.decode=function(e,t){if(!e||0===e.length)return new i([]);var r=function e(t){var r,n,o,a,u,c=[],l=t[0];if(l<=127)return{data:t.slice(0,1),remainder:t.slice(1)};if(l<=183){if(r=l-127,o=128===l?new i([]):t.slice(1,r),2===r&&o[0]<128)throw new Error("invalid rlp encoding: byte must be less 0x80");return{data:o,remainder:t.slice(r)}}if(l<=191){if(r=s(t.slice(1,n=l-182).toString("hex"),16),(o=t.slice(n,r+n)).length<r)throw new Error("invalid RLP");return{data:o,remainder:t.slice(r+n)}}if(l<=247){for(a=t.slice(1,r=l-191);a.length;)u=e(a),c.push(u.data),a=u.remainder;return{data:c,remainder:t.slice(r)}}var h=(n=l-246)+(r=s(t.slice(1,n).toString("hex"),16));if(h>t.length)throw new Error("invalid rlp: total length is larger than the data");if(0===(a=t.slice(n,h)).length)throw new Error("invalid rlp, List has a invalid length");for(;a.length;)u=e(a),c.push(u.data),a=u.remainder;return{data:c,remainder:t.slice(h)}}(e=c(e));return t?r:(n.equal(r.remainder.length,0,"invalid remainder"),r.data)},t.getLength=function(e){if(!e||0===e.length)return new i([]);var t=(e=c(e))[0];if(t<=127)return e.length;if(t<=183)return t-127;if(t<=191)return t-182;if(t<=247)return t-191;var r=t-246;return r+s(e.slice(1,r).toString("hex"),16)}},cC09:function(e,t,r){var n;n=function(e){e.version="1.2.0";var t=function(){for(var e=0,t=new Array(256),r=0;256!=r;++r)t[r]=e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=r)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1;return"undefined"!=typeof Int32Array?new Int32Array(t):t}();e.table=t,e.bstr=function(e,r){for(var n=-1^r,i=e.length-1,s=0;s<i;)n=(n=n>>>8^t[255&(n^e.charCodeAt(s++))])>>>8^t[255&(n^e.charCodeAt(s++))];return s===i&&(n=n>>>8^t[255&(n^e.charCodeAt(s))]),-1^n},e.buf=function(e,r){if(e.length>1e4)return function(e,r){for(var n=-1^r,i=e.length-7,s=0;s<i;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])];for(;s<i+7;)n=n>>>8^t[255&(n^e[s++])];return-1^n}(e,r);for(var n=-1^r,i=e.length-3,s=0;s<i;)n=(n=(n=(n=n>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])])>>>8^t[255&(n^e[s++])];for(;s<i+3;)n=n>>>8^t[255&(n^e[s++])];return-1^n},e.str=function(e,r){for(var n,i,s=-1^r,o=0,a=e.length;o<a;)(n=e.charCodeAt(o++))<128?s=s>>>8^t[255&(s^n)]:n<2048?s=(s=s>>>8^t[255&(s^(192|n>>6&31))])>>>8^t[255&(s^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),i=1023&e.charCodeAt(o++),s=(s=(s=(s=s>>>8^t[255&(s^(240|n>>8&7))])>>>8^t[255&(s^(128|n>>2&63))])>>>8^t[255&(s^(128|i>>6&15|(3&n)<<4))])>>>8^t[255&(s^(128|63&i))]):s=(s=(s=s>>>8^t[255&(s^(224|n>>12&15))])>>>8^t[255&(s^(128|n>>6&63))])>>>8^t[255&(s^(128|63&n))];return-1^s}},"undefined"==typeof DO_NOT_EXPORT_CRC?n(t):n({})},cpc2:function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},kMlx:function(e,t,r){"use strict";var n=r("8zgK");function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(e){return this._parser=e,this},i.prototype.responseType=function(e){return this._responseType=e,this},i.prototype.serialize=function(e){return this._serializer=e,this},i.prototype.timeout=function(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},i.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var s=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(e,t);if(!0===r)return!0;if(!1===r)return!1}catch(n){console.error(n)}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~s.indexOf(e.code))return!0;if(e.timeout&&"ECONNABORTED"==e.code)return!0;if(e.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(e,t){r.end((function(r,n){r?t(r):e(n)}))}))}return this._fullfilledPromise.then(e,t)},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.use=function(e){return e(this),this},i.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},i.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},i.prototype.getHeader=i.prototype.get=function(e){return this._header[e.toLowerCase()]},i.prototype.set=function(e,t){if(n(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},i.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},i.prototype.field=function(e,t){if(null==e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),n(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var i in t)this.field(e,t[i]);return this}if(null==t)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},i.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},i.prototype._auth=function(e,t,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},i.prototype.withCredentials=function(e){return null==e&&(e=!0),this._withCredentials=e,this},i.prototype.redirects=function(e){return this._maxRedirects=e,this},i.prototype.maxResponseSize=function(e){if("number"!=typeof e)throw TypeError("Invalid argument");return this._maxResponseSize=e,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(e){var t=n(e),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&n(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(r||this.type("form"),this._data="application/x-www-form-urlencoded"==(r=this._header["content-type"])?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)||r||this.type("json"),this},i.prototype.sortQuery=function(e){return this._sort=void 0===e||e,this},i.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var r=this.url.substring(t+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+"?"+r.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(e,t,r){if(!this._aborted){var n=new Error(e+t+"ms exceeded");n.timeout=t,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},i.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))}},lGYU:function(e,t,r){(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,void 0):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=r("HEbw"),h=r("+qE3").EventEmitter,f=r("4Mn8"),d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(d,e);var r,n,s,h=(n=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=c(n);if(s){var r=c(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return u(this,e)});function d(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,d),(e=h.call(this)).type="Lattice Hardware",e._resetDefaults(),e.deserialize(t),e}return(r=[{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.creds&&(this.creds=e.creds),e.accounts&&(this.accounts=e.accounts),e.walletUID&&(this.walletUID=e.walletUID),e.name&&(this.name=e.name),e.network&&(this.network=e.network),Promise.resolve()}},{key:"serialize",value:function(){return Promise.resolve({creds:this.creds,accounts:this.accounts,walletUID:this.walletUID,name:this.name,network:this.network})}},{key:"isUnlocked",value:function(){return this._hasCreds()&&this._hasSession()}},{key:"setHdPath",value:function(){console.warn("setHdPath not implemented.")}},{key:"unlock",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((function(r,n){e._getCreds().then((function(t){return t&&(e.creds.deviceID=t.deviceID,e.creds.password=t.password),e._initSession()})).then((function(){return e._connect(t)})).then((function(){return r("Unlocked")})).catch((function(e){return n(Error(e))}))}))}},{key:"addAccounts",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(r,n){e.unlock().then((function(){return e._fetchAddresses(t,e.unlockedAccount)})).then((function(n){var s;return e.accounts.splice(e.unlockedAccount,t),(s=e.accounts).splice.apply(s,[e.unlockedAccount,0].concat(i(n))),r(e.accounts)})).catch((function(e){return n(e)}))}))}},{key:"getAccounts",value:function(){return Promise.resolve(this.accounts?this.accounts.slice():[].slice())}},{key:"signTransaction",value:function(e,r){var n=this;return new Promise((function(i,s){n._unlockAndFindAccount(e).then((function(e){var t={chainId:r.getChainId(),nonce:Number("0x".concat(r.nonce.toString("hex")))||0,gasPrice:Number("0x".concat(r.gasPrice.toString("hex"))),gasLimit:Number("0x".concat(r.gasLimit.toString("hex"))),to:"0x".concat(r.to.toString("hex")),value:Number("0x".concat(r.value.toString("hex"))),data:0===r.data.length?null:"0x".concat(r.data.toString("hex")),signerPath:[2147483692,2147483708,2147483648,0,e]};return n._signTxData(t)})).then((function(e){return e.sig&&e.sig.v&&e.sig.r&&e.sig.s?(r.v=e.sig.v,r.r=t.from(e.sig.r,"hex"),r.s=t.from(e.sig.s,"hex"),i(r)):s(Error("No signature returned"))})).catch((function(e){return s(Error(e))}))}))}},{key:"signMessage",value:function(e,t){return console.warn("NOTE: signMessage is currently a proxy for signPersonalMessage!"),this.signPersonalMessage(e,t)}},{key:"signPersonalMessage",value:function(e,t){var r=this;return new Promise((function(n,i){r._unlockAndFindAccount(e).then((function(e){var s={currency:"ETH_MSG",data:{protocol:"signPersonal",payload:t,signerPath:[2147483692,2147483708,2147483648,0,e]}};if(!r._hasSession())return i("No SDK session started. Cannot sign transaction.");r.sdkSession.sign(s,(function(e,t){if(e)return i(e);if(!t.sig)return i("No signature returned");var r=(t.sig.v-27).toString(16);return r.length<2&&(r="0".concat(r)),n("0x".concat(t.sig.r).concat(t.sig.s).concat(r))}))}))}))}},{key:"exportAccount",value:function(e){return Promise.reject(Error("exportAccount not supported by this device"))}},{key:"removeAccount",value:function(e){this.forgetDevice()}},{key:"getFirstPage",value:function(){return this.page=0,this._getPage(1)}},{key:"getNextPage",value:function(){return this.getFirstPage()}},{key:"getPreviousPage",value:function(){return this.getFirstPage()}},{key:"setAccountToUnlock",value:function(e){this.unlockedAccount=parseInt(e,10)}},{key:"forgetDevice",value:function(){this._resetDefaults()}},{key:"_unlockAndFindAccount",value:function(e){var t=this;return new Promise((function(r,n){t.unlock(!1).then((function(){return t.getAccounts()})).then((function(t){var i=null;return t.forEach((function(t,r){e.toLowerCase()===t.toLowerCase()&&(i=r)})),null===i?n("Signer not present"):r(i)})).catch((function(e){return n(e)}))}))}},{key:"_resetDefaults",value:function(){this.accounts=[],this.isLocked=!0,this.creds={deviceID:null,password:null},this.walletUID=null,this.sdkSession=null,this.page=0,this.unlockedAccount=0,this.network=null}},{key:"_getCreds",value:function(){var e=this;return new Promise((function(t,r){if(e._hasCreds())return t();var n=e.name?e.name:"Unknown",i="https://wallet.gridplus.io";e.network&&"mainnet"!==e.network&&(i="https://gridplus-web-wallet-dev.herokuapp.com");var s="".concat(i,"?keyring=").concat(n);e.network&&(s+="&network=".concat(e.network)),window.open(s).postMessage("GET_LATTICE_CREDS",i),window.addEventListener("message",(function(e){if(e.origin===i)try{var n=JSON.parse(e.data);return n.deviceID&&n.password?t(n):r(Error("Invalid credentials returned from Lattice."))}catch(s){return r(s)}}),!1)}))}},{key:"_connect",value:function(e){var t=this;return new Promise((function(r,n){t.sdkSession.connect(t.creds.deviceID,(function(i){if(i)return n(i);var s=t.sdkSession.getActiveWallet();if(!s||!s.uid)return n("No active wallet");var o=s.uid.toString("hex");if(o!=t.walletUID){if(!1===e)return n("Wallet has changed! Please reconnect.");t.accounts=[],t.walletUID=o}return r()}))}))}},{key:"_initSession",value:function(){var e=this;return new Promise((function(t,r){if(e._hasSession())return t();try{var n="https://signing.gridpl.us";e.network&&"mainnet"!==e.network&&(n="https://signing.staging-gridpl.us");var i={name:e.name,baseUrl:n,crypto:l,timeout:12e4,privKey:e._genSessionKey(),network:e.network};return e.sdkSession=new f.Client(i),t()}catch(s){return r(s)}}))}},{key:"_fetchAddresses",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(n,i){return e._hasSession()?r>e.accounts.length?i("Requested address is out of bounds. You may only request index <".concat(e.accounts.length)):e.accounts.length>r?n(e.accounts.slice(r,t)):void e.sdkSession.getAddresses({currency:"ETH",startPath:[2147483692,2147483708,2147483648,0,r],n:t},(function(e,t){return e?i(Error("Error getting addresses: ".concat(e))):t.length<1?i("No addresses returned"):n(t)})):i("No SDK session started. Cannot fetch addresses.")}))}},{key:"_signTxData",value:function(e){var t=this;return new Promise((function(r,n){if(!t._hasSession())return n("No SDK session started. Cannot sign transaction.");t.sdkSession.sign({currency:"ETH",data:e},(function(e,t){return e?n(e):t.tx?r(t):n("No transaction payload returned.")}))}))}},{key:"_getPage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(r,n){e.page+=t,e.page<=0&&(e.page=1);var i=5*(e.page-1);e.unlock().then((function(){return e._fetchAddresses(1,0)})).then((function(e){var t=[];return e.forEach((function(e,r){t.push({address:e,balance:null,index:i+r})})),r(t)})).catch((function(e){return n(e)}))}))}},{key:"_hasCreds",value:function(){return null!==this.creds.deviceID&&null!==this.creds.password&&this.name}},{key:"_hasSession",value:function(){return this.sdkSession&&this.walletUID}},{key:"_genSessionKey",value:function(){if(!this._hasCreds())throw new Error("No credentials -- cannot create session key!");var e=t.concat([t.from(this.creds.password),t.from(this.creds.deviceID),t.from(this.name)]);return l.createHash("sha256").update(e).digest()}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(d.prototype,r),d}(h);d.type="Lattice Hardware",e.exports=d}).call(this,r("tjlA").Buffer)},nZbv:function(e,t){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach((function(e){r.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}})),r.prototype._setDefaults=function(e){this._defaults.forEach((function(t){e[t.fn].apply(e,t.arguments)}))},e.exports=r},oHnp:function(e,t,r){"use strict";t.type=function(e){return e.split(/ *; */).shift()},t.params=function(e){return e.split(/ *; */).reduce((function(e,t){var r=t.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(e[n]=i),e}),{})},t.parseLinks=function(e){return e.split(/ *, */).reduce((function(e,t){var r=t.split(/ *; */),n=r[0].slice(1,-1);return e[r[1].split(/ *= */)[1].slice(1,-1)]=n,e}),{})},t.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&(delete e.authorization,delete e.cookie),e}},pzNo:function(r,n,i){var s=i("24Ii"),o=i("6WMX"),a=i("xKF7"),u=i("PLHu"),c=u.signReqResolver,l=u.aes256_decrypt,h=u.aes256_encrypt,f=u.parseDER,d=u.checksum,p=u.getP256KeyPair,v=u.getP256KeyPairFromPub,g=u.parseLattice1Response,y=u.toPaddedDER,_=i("L21C"),E=_.ADDR_STR_LEN,m=_.ENC_MSG_LEN,w=_.decResLengths,S=_.deviceCodes,R=_.encReqCodes,b=_.responseCodes,T=_.REQUEST_TYPE_BYTE,P=_.VERSION_BYTE,I=_.messageConstants,x=_.BASE_URL,k=i("tjlA").Buffer,A=k.alloc(32);r.exports=function(){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.baseUrl,i=t.crypto,s=t.name,o=t.privKey,a=t.timeout,u=t.retryCount;if(e(this,r),s&&s.length>24)throw new Error("name must be less than 24 characters");if(!i)throw new Error("crypto provider is required");this.baseUrl=n||x,this.crypto=i,this.name=s||"Unknown",this.privKey=o||this.crypto.randomBytes(32),this.key=p(this.privKey),this.ephemeralPub=null,this.sharedSecret=null,this.timeout=a||6e4,this.deviceId=null,this.isPaired=!1,this.retryCount=u||3,this.activeWallets={internal:{uid:A,name:null,capabilities:null,external:!1},external:{uid:A,name:null,capabilities:null,external:!0}}}var n,i,u;return n=r,(i=[{key:"connect",value:function(e,t){var r=this;if("function"==typeof e){if(!this.deviceId)return t("No device ID has been stored. Please connect with your device ID first.");t=e}else this.deviceId=e;var n=this._buildRequest(S.CONNECT,this.pubKeyBytes());this._request(n,(function(e,n){return e?t(e):(r.isPaired=r._handleConnect(n),r.isPaired?void r._getActiveWallet((function(e){return t(e,r.isPaired)}),!0):t(null))}))}},{key:"pair",value:function(e,t){var r=this,n=this.pubKeyBytes(),i=k.alloc(25);if(this.name.length>24)return t("Name is too many characters. Please change it to <25 characters.");i.write(this.name);var s=k.concat([n,i,k.from(e)]),o=this.crypto.createHash("sha256").update(s).digest(),a=this.key.sign(o),u=y(a),c=k.concat([i,u]),l=this._buildEncRequest(R.FINALIZE_PAIRING,c);this._request(l,(function(e,n){if(e)return t(e);var i=r._handlePair(n);if(i)return t(i);r._getActiveWallet((function(e){return e?t(e):t(null,r.hasActiveWallet())}),!0)}))}},{key:"test",value:function(e,t){var r=this;if(!e.payload)return t("First argument must contain `testID` and `payload` fields.");var n=k.alloc(506);n.writeUInt32BE(e.testID,0),n.writeUInt16BE(e.payload.length,4),e.payload.copy(n,6);var i=this._buildEncRequest(R.TEST,n);this._request(i,(function(e,n){if(e)return t(e);var i=r._handleEncResponse(n,w.test);return null!==i.err?t(i.err):t(null,i.data.slice(65))}))}},{key:"getAddresses",value:function(e,t){var r=this,n=e.startPath,i=e.n;if(void 0===n||void 0===i||5!==n.length)return t("Please provide `startPath` and `n` options");var s=k.alloc(33+4*n.length),o=0,a=this.getActiveWallet();if(null===a)return t("No active wallet.");a.uid.copy(s,o),o+=32;for(var u=0;u<n.length;u++)s.writeUInt32BE(n[u],o),o+=4;s.writeUInt8(i,o),o++;var c=this._buildEncRequest(R.GET_ADDRESSES,s);return this._request(c,(function(e,n){if(e)return t(e);var i=r._handleGetAddresses(n);return i.err?t(i.err):t(null,i.data)}))}},{key:"sign",value:function(e,t){var r=this,n=e.currency,i=e.data;if(void 0===n||void 0===i)return t("Please provide `currency` and `data` options");if(void 0===c[n])return t("Unsupported currency");var s=c[n](i);if(void 0!==s.err)return t({err:s.err});if(s.payload.length>1152)return t("Transaction is too large");var o=k.alloc(1154),a=0;o.writeUInt16BE(s.schema,a),a+=2;var u=this.getActiveWallet();if(null===u)return t("No active wallet.");u.uid.copy(o,a),a+=u.uid.length,s.payload.copy(o,a);var l=this._buildEncRequest(R.SIGN_TRANSACTION,o);return this._request(l,(function(i,o,a){if(a===b.RESP_ERR_WALLET_NOT_PRESENT)r._getActiveWallet((function(n){return n?t(n):r.sign(e,t)}));else{if(!i){var u=r._handleSign(o,n,s);return t(u.err,u.data)}if(i)return t(i)}}))}},{key:"_getActiveWallet",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!0===r||!0!==this.hasActiveWallet()&&!0===this.isPaired){var n=k.alloc(0),i=this._buildEncRequest(R.GET_WALLETS,n);return this._request(i,(function(r,n){return r?(t._resetActiveWallets(),e(r)):e(t._handleGetWallets(n))}))}return e(null)}},{key:"_getSharedSecret",value:function(){return k.from(this.key.derive(this.ephemeralPub.getPublic()).toArray("be",32))}},{key:"_getEphemId",value:function(){if(null===this.ephemeralPub)return null;var e=this._getSharedSecret();return this.crypto.createHash("sha256").update(e).digest().slice(0,4)}},{key:"_buildEncRequest",value:function(e,t){var r=parseInt(this._getEphemId().toString("hex"),16),n=k.concat([k.from([e]),t]),i=d(n),s=k.alloc(n.length+4);n.copy(s,0),s.writeUInt32LE(i,n.length);var o=this._getSharedSecret(),a=h(s,o),u=k.alloc(m+4);return u.writeUInt32LE(r,0),a.copy(u,4),this._buildRequest(S.ENCRYPTED_REQUEST,u)}},{key:"_buildRequest",value:function(e,t){var r=t&&k.isBuffer(t)?t.length+1:1;e===S.ENCRYPTED_REQUEST&&(r=1+t.length);var n=0,i=k.alloc(r+8);n=i.writeUInt8(P,n),n=i.writeUInt8(T,n);var s=this.crypto.randomBytes(4);n=i.writeUInt32BE(parseInt("0x"+s.toString("hex")),n),n=i.writeUInt16BE(r,n),n=i.writeUInt8(e,n),r>1&&(n=t.copy(i,n));var o=d(i),a=k.alloc(i.length+4);return n=i.copy(a),a.writeUInt32BE(o,n),a}},{key:"_request",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.retryCount;if(!this.deviceId)return t("Serial is not set. Please set it and try again.");s.post("".concat(this.baseUrl,"/").concat(this.deviceId)).timeout(this.timeout).send({data:e}).then((function(i){if(!i||!i.body)return t("Invalid response: "+i);if(200!==i.body.status)return t("Error code ".concat(i.body.status,": ").concat(i.body.message));var s=g(i.body.message);return(s.responseCode===b.RESP_ERR_DEV_BUSY||s.responseCode===b.RESP_ERR_GCE_TIMEOUT)&&n>0?setTimeout((function(){r._request(e,t,n-1)}),3e3):(s.responseCode===b.RESP_ERR_WALLET_NOT_PRESENT&&r._resetActiveWallets(),s.err?t(s.err):t(null,s.data,s.responseCode))})).catch((function(e){return t("ECONNABORTED"===e.code&&"ETIME"===e.errno?"Timeout waiting for device. Please ensure it is connected to the internet and try again in a minute.":"Failed to make request to device.")}))}},{key:"_handleConnect",value:function(e){var t=0,r=e.readUInt8(t);t++;var n=e.slice(t,e.length).toString("hex");return this.ephemeralPub=v(n),r===I.PAIRED}},{key:"_handleEncResponse",value:function(e,t){var r=this._getSharedSecret(),n=e.slice(0,m),i=l(n,r),s=i.slice(0,t+=65),o=parseInt("0x"+i.slice(t,t+4).toString("hex")),a=d(s);if(o!==a)return{err:"Checksum mismatch in response from Lattice (calculated ".concat(a,", wanted ").concat(o,")")};var u=i.slice(0,65).toString("hex");try{return this.ephemeralPub=v(u),{err:null,data:i}}catch(c){return{err:"Error handling getAddresses response: "+c.toString()}}}},{key:"_handlePair",value:function(e){var t=this._handleEncResponse(e,w.finalizePair);return t.err?t.err:(this.pairingSalt=null,this.isPaired=!0,null)}},{key:"_handleGetAddresses",value:function(e){var t=this._handleEncResponse(e,w.getAddresses);if(null!==t.err)return t;for(var r=t.data,n=65,i=[];n+4<w.getAddresses;){var s=r.slice(n,n+E);n+=E;var o=s.indexOf(0);o>0&&i.push(s.slice(0,o).toString())}return{data:i,err:null}}},{key:"_handleGetWallets",value:function(e){var t=this._handleEncResponse(e,w.getWallets);if(null!==t.err)return t;var r,n=t.data,i=65,s=!1;return r=n.slice(i,i+32),this.activeWallets.internal.uid=r,this.activeWallets.internal.capabilities=n.readUInt32BE(i+32),this.activeWallets.internal.name=n.slice(i+36,i+71),r.equals(A)||(s=!0),i+=71,r=n.slice(i,i+32),this.activeWallets.external.uid=r,this.activeWallets.external.capabilities=n.readUInt32BE(i+32),this.activeWallets.external.name=n.slice(i+36,i+71),r.equals(A)||(s=!0),!0===s?null:"No active wallet."}},{key:"_handleSign",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._handleEncResponse(e,w.sign);if(null!==n.err)return{err:n.err};var i,s=65,u=n.data;if("BTC"===t){var c=o.addressVersion[r.changeData.changeVersion],l=u.slice(s,s+20);s+=20,i=o.getBitcoinAddress(l,c)}var h={err:null,data:null};if("BTC"===t){for(var d=33,p=[],v=[],g=0;s<u.length&&48===u[s];)v.push(u.slice(s,s+2+u[s+1])),p.push(u.slice(g*d+825,(g+1)*d+825)),s+=74,g+=1;var y={inputs:[],outputs:[],isSegwitSpend:r.origData.isSegwit,network:r.origData.network,crypto:this.crypto};y.outputs.push({value:r.origData.value,recipient:r.origData.recipient}),r.changeData.value>0&&y.outputs.push({value:r.changeData.value,recipient:i});for(var _=0;_<v.length;_++)y.inputs.push({hash:r.origData.prevOuts[_].txHash,index:r.origData.prevOuts[_].index,sig:v[_],pubkey:p[_]});var E=o.serializeTx(y),m=E;!0===y.isSegwitSpend&&(y.isSegwitSpend=!1,m=o.serializeTx(y));var S=this.crypto.createHash("sha256").update(k.from(m,"hex")).digest();S=this.crypto.createHash("sha256").update(S).digest().reverse().toString("hex"),h.data={tx:E,txHash:S,changeRecipient:i,sigs:v}}else if("ETH"===t){var R=f(u.slice(s,s+2+u[s+1]));s+=74;var b=u.slice(s,s+20),T=a.buildEthRawTx(r,R,b,r.useEIP155);h.data={tx:"0x"+T,txHash:"0x"+a.hashTransaction(T),sig:{v:R.v,r:R.r.toString("hex"),s:R.s.toString("hex")},signer:b}}else if("ETH_MSG"===t){var P=f(u.slice(s,s+2+u[s+1]));s+=74;var I=u.slice(s,s+20),x=a.validateEthereumMsgResponse({signer:I,sig:P},r);h.data={sig:{v:x.v,r:x.r.toString("hex"),s:x.s.toString("hex")},signer:I}}return h}},{key:"_resetActiveWallets",value:function(){this.activeWallets.internal.uid=A,this.activeWallets.internal.name=null,this.activeWallets.internal.capabilities=null,this.activeWallets.external.uid=A,this.activeWallets.external.name=null,this.activeWallets.external.capabilities=null}},{key:"getActiveWallet",value:function(){return A.equals(this.activeWallets.external.uid)?A.equals(this.activeWallets.internal.uid)?null:this.activeWallets.internal:this.activeWallets.external}},{key:"hasActiveWallet",value:function(){return null!==this.getActiveWallet()}},{key:"pubKeyBytes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key.getPublic().encode("hex"),r=k.from(t,"hex");if(!0===e){var n=r.slice(1,33).reverse(),i=r.slice(33,65).reverse();return k.concat([r[0],n,i])}return r}}])&&t(n.prototype,i),u&&t(n,u),r}()},xKF7:function(e,t,r){var n=r("tjlA").Buffer,i=r("L21C"),s=r("HFX+").keccak256,o=r("RP9m"),a=r("IzB8");function u(e){for(var t=e[0];e.length>0&&"0"===t.toString();)t=(e=e.slice(1))[0];return e}function c(e,t,r,i,o){try{var u=new Uint8Array(n.from(s(e),"hex"));t.v=27;var c=f(t.r,32);t.r=c;var l=f(t.s,32);t.s=l;var p=new Uint8Array(n.concat([c,l])),v=a.ecdsaRecover(p,t.v-27,u,!1).slice(1);if(h(v)===r.toString("hex"))return!0===o&&(t.v=d(t.v,i)),t;if(t.v=28,h(v=a.ecdsaRecover(p,t.v-27,u,!1).slice(1))===r.toString("hex"))return!0===o&&(t.v=d(t.v,i)),t;throw new Error("Invalid Ethereum signature returned.")}catch(g){throw new Error(g)}}function l(e){return null===e||0===e?n.alloc(0):(n.isBuffer(e)&&(e=e.toString("hex")),"number"==typeof e?e=""+e.toString(16):"string"==typeof e&&"0x"===e.slice(0,2)&&(e=e.slice(2)),e.length%2>0&&(e="0"+e),n.from(e,"hex"))}function h(e){return s(e).slice(-40)}function f(e,t){var r=n.alloc(t);return e.length<t?(e.copy(r,t-e.length),r):e.slice(-t)}function d(e,t){return e+2*t+8}t.buildEthereumMsgRequest=function(e){if(!e.payload||!e.protocol||!e.signerPath)throw new Error("You must provide `payload`, `signerPath`, and `protocol` arguments in the messsage request");var t,r={schema:i.signingSchema.ETH_MSG,payload:null,input:e,msg:null};if("signPersonal"===e.protocol){var s=0;r.payload=n.alloc(4*(e.signerPath.length+1)+i.ETH_MSG_MAX_SIZE+4),r.payload.writeUInt8(i.ethMsgProtocol.SIGN_PERSONAL,0),s+=1,r.payload.writeUInt32LE(e.signerPath.length,s),s+=4;for(var o=0;o<e.signerPath.length;o++)r.payload.writeUInt32LE(e.signerPath[o],s),s+=4;var a=e.payload,u=!1;if("string"==typeof e.payload?"0x"===e.payload.slice(0,2)?u=!1===(t=(a=l(e.payload)).toString(),/^[\x00-\x7F]*$/.test(t)):a=n.from(e.payload):"boolean"==typeof e.displayHex&&(u=e.displayHex),a.length>i.ETH_MSG_MAX_SIZE)throw new Error("Your payload is ".concat(a.length," bytes, but can only be a maximum of ").concat(i.ETH_MSG_MAX_SIZE));return r.msg=a,r.payload.writeUInt8(u,s),s+=1,r.payload.writeUInt16LE(a.length,s),s+=2,a.copy(r.payload,s),r}throw new Error("Unsupported protocol")},t.validateEthereumMsgResponse=function(e,t){var r=e.signer,i=e.sig,s=t.input,o=t.msg;if("signPersonal"===s.protocol){var a=n.from("\x19Ethereum Signed Message:\n"+o.length.toString(),"utf-8");return c(n.concat([a,o]),i,r)}throw new Error("Unsupported protocol")},t.buildEthereumTxRequest=function(e){try{var t=e.chainId,r=void 0===t?1:t,s=e.signerPath;if("number"!=typeof r&&(r=p[r]),!r)throw new Error("Unsupported chain name");if(!s||5!==s.length)throw new Error("Please provider full signer path (`signerPath`)");var o=v[r];e.value||(e.value=0);var a=[],u=l(e.nonce),c=l(e.gasPrice),h=l(e.gasLimit),f=l(e.to),d=l(e.value),g=l(e.data);a.push(u),a.push(c),a.push(h),a.push(f),a.push(d),a.push(g),!0===o&&(a.push(l(r)),a.push(l(null)),a.push(l(null)));var y=n.alloc(1146),_=0;y.writeUInt8(Number(o),_),_++,y.writeUInt8(Number(r),_),_++,y.writeUInt32LE(s.length,_),_+=4;for(var E=0;E<s.length;E++)y.writeUInt32LE(s[E],_),_+=4;return y.writeUInt32BE(e.nonce,_),_+=4,function(e,t,r){"number"==typeof e&&(e=e.toString(16));var i=n.alloc(8),s=e.length%2==0?e.toString(16):"0"+e.toString(16),o=n.from(s,"hex");o.copy(i,i.length-o.length),i.copy(t,r)}(e.gasPrice,y,_),_+=8,y.writeUInt32BE(e.gasLimit,_),_+=4,f.copy(y,_),_+=20,d.copy(y,_+32-d.length),_+=32,g&&g.length>i.ETH_DATA_MAX_SIZE?{err:"Data field too large (must be <=".concat(i.ETH_DATA_MAX_SIZE," bytes)")}:(y.writeUInt16BE(g.length,_),_+=2,g.copy(y,_),_+=1024,{rawTx:a,payload:y,schema:i.signingSchema.ETH_TRANSFER,chainId:r,useEIP155:o,signerPath:s})}catch(m){return{err:m.message}}},t.buildEthRawTx=function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=c(o.encode(e.rawTx),t,r,e.chainId,i),a=e.rawTx.slice(0,6);return a.push(n.from(s.v.toString(16),"hex")),a.push(u(s.r)),a.push(u(s.s)),o.encode(a).toString("hex")},t.addRecoveryParam=c,t.hashTransaction=function(e){return s(n.from(e,"hex"))};var p={mainnet:1,roptsten:3,rinkeby:4,kovan:42,goerli:5},v={1:!0,3:!1,4:!1,42:!0,5:!0};t.chainIds=p}}])}();